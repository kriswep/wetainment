{"componentChunkName":"component---src-templates-blog-post-js","path":"/revealing-prismagraphql-magic/","result":{"data":{"markdownRemark":{"html":"<h4>Explore the tricks</h4>\n<p><strong>Tl,dr: <a href=\"https://www.prisma.io/\">Prisma GraphQL</a> helps you write a realtime GraphQL API with ease! Using it may sometimes feel like magic, at least if one doesn’t know what happens where. But in the end it really boils down to clever engineering.</strong></p>\n<p>The team from <a href=\"https://graph.cool\">graph.cool</a> launched their Prisma GraphQL project in mid January 2018. At the heart it is a API layer using <a href=\"https://graphql.org/\">GraphQL</a>. It uses some amazing techniques for that, and that could feel like true magic. So, let us explore Prisma as if it was a Las Vegas show. To get the most out of this article, it would be best if you already know GraphQL. You could catch up on <a href=\"https://www.howtographql.com/\">How to GraphQL</a>. Also try to follow along on your machine. If you can’t, find the code, we are going to look at, over <a href=\"https://github.com/kriswep/prisma-show\">here</a>.</p>\n<p><strong>Since writting this article a new Prisma version was released (1.7).\nSome of the introduced changes revealed a little bit magic by exposing a <code class=\"language-text\">docker-compose.yml</code>.\nRead more at their <a href=\"https://github.com/graphcool/prisma/releases/tag/1.7.0\">release notes</a>.\nStill, the things written here hold true and the commands were changed as needed.</strong></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDBAX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAAB5M3ZMwxv/8QAGhABAQEAAwEAAAAAAAAAAAAAAQIAAxARIv/aAAgBAQABBQKZ+WU6LZzz05fd/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAGBAAAgMAAAAAAAAAAAAAAAAAABARMUH/2gAIAQEABj8Ckp4v/8QAHRABAAIBBQEAAAAAAAAAAAAAAQARIRAxQVGBkf/aAAgBAQABPyFWktOE3iWWeaFUOOoNWEVW18n/2gAMAwEAAgADAAAAEMjP/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QWf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABwQAQEBAAIDAQAAAAAAAAAAAAERAEFhITGRsf/aAAgBAQABPxB3cqMY/OcgGpUVmca0fZ5PmCAEkh6mQgl6b//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"A circus show with elephants and different artists, some of them on motorcyles.\"\n        title=\"A circus show with elephants and different artists, some of them on motorcyles.\"\n        src=\"/static/a93d8e4c21d5258595f649affb5cbfe5/1c72d/circus.jpg\"\n        srcset=\"/static/a93d8e4c21d5258595f649affb5cbfe5/a80bd/circus.jpg 148w,\n/static/a93d8e4c21d5258595f649affb5cbfe5/1c91a/circus.jpg 295w,\n/static/a93d8e4c21d5258595f649affb5cbfe5/1c72d/circus.jpg 590w,\n/static/a93d8e4c21d5258595f649affb5cbfe5/a8a14/circus.jpg 885w,\n/static/a93d8e4c21d5258595f649affb5cbfe5/fbd2c/circus.jpg 1180w,\n/static/a93d8e4c21d5258595f649affb5cbfe5/e8277/circus.jpg 6016w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n    </span></p>\n<p><sub><sup>Feel the magic circus atmosphere? Photo by <a href=\"https://unsplash.com/@beckyphan\">Becky Phan</a> on <a href=\"https://unsplash.com/photos/o8-670KHgK8\">Unsplash</a>.</sup></sub></p>\n<h4>Enjoy the show</h4>\n<p>Grab your free tickets by entering the following commands in your prompt:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> -g prisma graphql-cli\ngraphql create prisma-show</code></pre></div>\n<p>There are different shows running, let me select you a fun one. When asked, choose the following option:</p>\n<ul>\n<li><code class=\"language-text\">typescript-advanced GraphQL server (incl. database &amp; authentication)</code></li>\n</ul>\n<p>Prisma will set up your theatre stage, just wait a bit. When asked about the cluster, choose local, if you have a docker and docker-compose installation on your machine. Otherwhise one of the public cloud options will cover you, albeit not as cool. Newer versions might not ask you about deployment clusters. If you want to work on a local setup, you will need to remove the <code class=\"language-text\">PRISMA_ENDPOINT</code> from the <code class=\"language-text\">.env</code> file and run <code class=\"language-text\">prisma deploy</code>. To start your local cluster, try <code class=\"language-text\">prisma init</code>.</p>\n<p>Done? Saw that information about changed types and fields? That’s a little hint about Prismas’ tricks, but we’ll have a closer look at that later.</p>\n<p>Alright enter the theatre, lets start the show!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token builtin class-name\">cd</span> prisma-show\n<span class=\"token function\">npm</span> run dev</code></pre></div>\n<p>Welcome to our playground, the <a href=\"/playground-better-graphiql/\">GraphQL Explorer App</a> that should have been opened just now (if not, try opening <a href=\"http://localhost:3000/playground\">http://localhost:3000/playground</a>)</p>\n<p>Here, we can play and explore our API. Run a query</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token punctuation\">{</span>\n  feed <span class=\"token punctuation\">{</span>\n    title\n    text\n    author <span class=\"token punctuation\">{</span>\n      name\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Or a mutation</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">mutation</span> <span class=\"token punctuation\">{</span>\n  signup<span class=\"token punctuation\">(</span><span class=\"token attr-name\">email</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"demo@example.com\"</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"demo\"</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">password</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"secret\"</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    token\n    user <span class=\"token punctuation\">{</span>\n      name\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Not that impressed? Alright, yeah, it just looks like a pretty normal GraphQL server. I’d say, that is already very impressing at its own, regarding we didn’t touch a single line of code yet. Still, let me draw your attention to the GraphQL database API. That got generated and wired up with a database a moment ago, just for you. See that database/dev option on the right hand side of the playground? Open that up, click the circular refresh arrow in the upper middle area and open up the schema on the left hand side. Take a look at that, theres a full fledged GraphQL CRUD schema, with different nodes, connections and a lot of neat mutations? Hold on, there are even some subscriptions in that? You can explore it right now.</p>\n<p>That looks pretty cool, right?</p>\n<h4>Behind the scenes</h4>\n<p>So, what is happening here? Here’s the revelation: There are two servers at work for you. First one is the Prisma API server, which was created by issuing the <code class=\"language-text\">prisma init</code> command. It can be redeployed with <code class=\"language-text\">prisma deploy</code>. Where does this server live? It’s contained inside a docker environment, which Prisma set up for you. If you choosed the local options, you can see two relevant images on your system, when running <code class=\"language-text\">docker ps -a</code>. One is the database, the other the API server. If you deployed to Prisma cloud, this stuff runs over there.</p>\n<p>Secondly, there’s your application server. This was started by the <code class=\"language-text\">npm run dev</code> command. This is where you reign and basically write GraphQL resolvers to your liking. The idea is, to write the needed business logic here and delegate the data querying to the Prisma API. How would that work? Do you have to connect and send some http calls around? Glad you asked, that was made a lot easier for you. Take a look at <code class=\"language-text\">./src/resovers/Query.ts</code>. There you’ll see code like this</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">feed</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">parent<span class=\"token punctuation\">,</span> args<span class=\"token punctuation\">,</span> ctx<span class=\"token operator\">:</span> Context<span class=\"token punctuation\">,</span> info</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> ctx<span class=\"token punctuation\">.</span>db<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">.</span><span class=\"token function\">posts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> where<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> isPublished<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This basically delegates the query execution to the Prisma API. Nice, it almost looks like an <a href=\"https://en.wikipedia.org/wiki/Object-relational_mapping\">ORM</a>. Feel free to play around with it, you might even get code completion, depending on your environment. The db objects comes from the GraphQL Bindings project, initiated by the graph.cool/prisma team and introduced <a href=\"https://www.prisma.io/blog/reusing-and-composing-graphql-apis-with-graphql-bindings-80a4aa37cff5/\">on their blog</a>. More exactly, it uses <a href=\"https://github.com/graphcool/prisma-binding\">Prisma binding</a>. That’s set up right in our application code, in <code class=\"language-text\">./src/index.ts</code>. See, no magic here!</p>\n<p>Oh, did I tell you where all this code in front of us came from? <code class=\"language-text\">primsa init</code> pulled that right from the <a href=\"https://github.com/graphql-boilerplates\">GraphQL Boilerplates</a> GitHub organization, we used <a href=\"https://github.com/graphql-boilerplates/typescript-graphql-server\">TypeScript variant</a>. There are a lot more, if you want to explore.</p>\n<p>And we can see even more cool things, some of them only in the pipeline. I keep it short for now:</p>\n<ul>\n<li>Control how you model your data, defined in <code class=\"language-text\">./database/datamodel.graphql</code></li>\n<li><a href=\"https://www.prisma.io/docs/tutorials/cluster-deployment/kubernetes-aiqu8ahgha\">Deploy</a> options to the cloud, local or to some kind of <a href=\"https://www.prisma.io/docs/reference/clusters/overview-eu2ood0she\">cluster</a></li>\n<li>Choices of underlying database (coming soon)</li>\n<li>Database <a href=\"https://www.prisma.io/docs/reference/data-import-and-export/data-import-ol2eoh8xie/\">export/import</a> and seeding</li>\n</ul>\n<p>Hope this motivated you to give Prisma a try. If you get stuck along the way, the <a href=\"https://www.prisma.io/docs\">docs</a> are great and there is an active <a href=\"https://slack.graph.cool/\">slack</a>.\nOk, enjoy the show, have a great evening, and be ready to be amazed by the awesome people moving the GraphQL ecosystem forward! Thanks and shoutout to (graph.cool).</p>","fields":{"slug":"/articles/2018-02-Revealing-Prisma-GraphQL-Magic/"},"frontmatter":{"date":"March 05, 2018","path":"/revealing-prismagraphql-magic/","title":"Revealing Prisma GraphQL's magic tricks","description":"Prisma is a GraphQL API Layer. Trying it out with one of the available boilerplates gives you a ton of great features, almost feeling like magic. But is it? Let's have a look behind the tricks!","author":"@kriswep","layout":"post","readNext":"/articles/2020-01-CRA-Template/","issueNumber":17}},"readNext":{"frontmatter":{"date":"January 12, 2020","path":"/articles/create-react-app-template/","title":"Write your own Create React App template","description":"Create React App can bootstrap your React applications. Nowadays, you can even use a template to quickly start your projects with your preferred stack. Learn how to write and publish your own template."}},"site":{"siteMetadata":{"title":"wetainment","siteUrl":"https://wetainment.com"}}},"pageContext":{"slug":"/articles/2018-02-Revealing-Prisma-GraphQL-Magic/","readNext":"/articles/2020-01-CRA-Template/"}},"staticQueryHashes":[]}